<!-- BOUTON FLOTTANT -->
<button id="alp-toggle" style="
  position:fixed;
  bottom:15px;
  right:20px;
  z-index:999999;
  background:#002D58;
  color:#D4AF37;
  border:2px solid #D4AF37;
  border-radius:50%;
  width:60px;
  height:60px;
  cursor:pointer;
  font-size:24px;
  box-shadow:0 4px 15px rgba(0,0,0,0.4);
">
ðŸ’¬
</button>

<!-- CHATBOX -->
<div id="alp-chat-box">
  <iframe 
    src="https://alpina-bot.vercel.app"
    allow="clipboard-write"
  ></iframe>
</div>

<style>
/* ===== GLOBAL MOBILE & IOS SAFE ===== */
html, body {
  overflow-x: hidden;
  margin: 0;
  padding: 0;
  height: 100%;
}

/* ===== DESKTOP (STRICTEMENT INCHANGÃ‰) ===== */
#alp-chat-box {
  display: none;
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 370px;
  height: 540px;
  z-index: 999998;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  background: #fff;
}

#alp-chat-box iframe {
  width: 100%;
  height: 100%;
  border: none;
}

/* ===== MOBILE VERSION STABLE ===== */
@media (max-width: 768px) {
  #alp-chat-box {
    left: 4% !important;
    right: auto !important;
    width: 92% !important;
    max-width: 92% !important;
    height: calc(100vh - 20px) !important;  /* prend presque tout l'Ã©cran */
    max-height: 95vh !important;             /* jamais plus que le viewport */
    bottom: 10px !important;                 /* toujours visible avec clavier */
    border-radius: 18px;
    transition: height 0.2s ease, bottom 0.2s ease; /* animation douce clavier */
  }

  /* Ajuste la hauteur en cas d'ouverture du clavier */
  body.keyboard-open #alp-chat-box {
    height: calc(100vh - env(safe-area-inset-top) - 10px) !important;
    bottom: env(safe-area-inset-bottom) !important;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const chatBox = document.getElementById('alp-chat-box');
  const toggleBtn = document.getElementById('alp-toggle');

  if (!chatBox || !toggleBtn) return;

  // Toggle bouton
  toggleBtn.addEventListener("click", function() {
    chatBox.style.display =
      chatBox.style.display === "block" ? "none" : "block";
  });

  // ===== GESTION MOBILE CLAVIER =====
  let initialViewportHeight = window.innerHeight;

  window.addEventListener('resize', () => {
    const vh = window.innerHeight;
    if(vh < initialViewportHeight) {
      // Clavier ouvert
      document.body.classList.add('keyboard-open');
    } else {
      // Clavier fermÃ©
      document.body.classList.remove('keyboard-open');
    }
  });

});
</script>
